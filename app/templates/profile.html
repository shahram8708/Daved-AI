
{% extends "base.html" %}

{% block title %}Profile Settings · Daved AI{% endblock %}

{% block content %}

<svg aria-hidden="true" class="d-none">
  <defs>
    
    <filter id="glow" x="-40%" y="-40%" width="180%" height="180%">
      <feGaussianBlur stdDeviation="3.5" result="coloredBlur" />
      <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>

    
    <symbol id="i-user" viewBox="0 0 24 24">
      <circle cx="12" cy="8" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M4 21a8 8 0 0 1 16 0" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-mail" viewBox="0 0 24 24">
      <path d="M4 5h16v14H4z" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M4 7l8 6 8-6" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-lock" viewBox="0 0 24 24">
      <rect x="4" y="10" width="16" height="10" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-gear" viewBox="0 0 24 24">
      <path d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm8 4-2.2.7.4 2.3-2.1 1.2-1.6-1.7-2.3.4L12 20l-1.2-2.1-2.3-.4-1.6 1.7-2.1-1.2.4-2.3L3 12l2.2-.7-.4-2.3 2.1-1.2 1.6 1.7 2.3-.4L12 4l1.2 2.1 2.3.4 1.6-1.7 2.1 1.2-.4 2.3L20 12Z" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-globe" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-download" viewBox="0 0 24 24">
      <path d="M12 3v12M8 11l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M4 21h16" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-cloud" viewBox="0 0 24 24">
      <path d="M6 18a4 4 0 1 1 1-7 5 5 0 0 1 10 1h1a3 3 0 0 1 0 6H6z" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-check" viewBox="0 0 24 24">
      <path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
    <symbol id="i-x" viewBox="0 0 24 24">
      <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
  </defs>
</svg>


<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

  :root{
    --bg:#0b0f1a;
    --bg-soft:#0f1526;
    --card:#121a2d;
    --line:#1b2540;
    --text:#d7e3ff;
    --muted:#9bb0d8;
    --primary:#7c4dff;
    --cyan:#24e1ff;
    --grad-1:#6a00ff;
    --grad-2:#00e1ff;
    --grad-3:#8a2be2;
  }

  body{ background: radial-gradient(1200px 600px at 10% -10%, #1a2341 0%, transparent 60%), var(--bg); color: var(--text); font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }

  
  .tech-grid::before{
    content:""; position:absolute; inset:0; background:
      linear-gradient(transparent 95%, rgba(255,255,255,.04) 95%) 0 0/100% 2px,
      linear-gradient(90deg, transparent 95%, rgba(255,255,255,.04) 95%) 0 0/2px 100%;
    pointer-events:none; mix-blend:overlay;
  }
  .scanline::after{
    content:""; position:absolute; inset:0; background: linear-gradient(rgba(255,255,255,0.05), rgba(255,255,255,0) 80%);
    opacity:.2; animation: scan 6s linear infinite; pointer-events: none;
  }
  @keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}

  
  .neon{ background: linear-gradient(135deg, var(--grad-1), var(--grad-2), var(--grad-3)); background-size:200% 200%; animation: gradientMove 10s ease infinite; }
  @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

  
  .badge-chip{ display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .65rem; border-radius:999px; background: rgba(124,77,255,.12); border:1px solid rgba(124,77,255,.25); color:var(--muted); font-weight:600; font-size:.9rem; }
  .btn-neon{
    --bs-btn-bg: transparent; --bs-btn-border-color: rgba(124,77,255,.5); --bs-btn-color:#fff;
    border:1px solid var(--bs-btn-border-color); backdrop-filter: blur(6px);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 0 20px rgba(124,77,255,.25);
    transition: transform .25s, box-shadow .25s, border-color .25s;
  }
  .btn-neon:hover{ transform: translateY(-2px); border-color: var(--cyan); box-shadow: 0 8px 30px rgba(36,225,255,.25); }
  .btn-solid{ background: linear-gradient(135deg, var(--grad-1), var(--grad-2)); border:0; color:#fff; box-shadow: 0 6px 30px rgba(124,77,255,.35); }
  .btn-solid:hover{ filter: brightness(1.08); transform: translateY(-2px); }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--card);
    border: 1px solid rgba(255,255,255,.06); border-radius: 16px;
    transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s, border-color .35s; position:relative; overflow:hidden;
  }
  .panel:hover{ transform: translateY(-4px); box-shadow: 0 16px 60px rgba(0,0,0,.35), 0 0 60px rgba(124,77,255,.15); border-color: rgba(124,77,255,.35); }
  .panel-header{ border-bottom:1px solid rgba(255,255,255,.06); background:#0b1224; padding:.9rem 1rem; }
  .panel-title{ margin:0; display:flex; align-items:center; gap:.6rem; font-weight:700; }
  .ico{
    width:40px; height:40px; display:grid; place-items:center; border-radius:12px; color:#fff;
    background: radial-gradient(circle at 30% 30%, rgba(36,225,255,.25), rgba(124,77,255,.45));
    box-shadow: 0 10px 30px rgba(124,77,255,.35) inset; filter:url(#glow);
  }
  .tilt{ will-change: transform; }

  
  .form-label{ font-weight:600; }
  .form-control, .form-select{
    background:#0e162b; border:1px solid rgba(255,255,255,.08); color:var(--text);
    border-radius:12px; padding:.8rem 1rem;
  }
  .form-control:focus, .form-select:focus{
    border-color: rgba(36,225,255,.6); box-shadow: 0 0 0 .25rem rgba(36,225,255,.15);
    background:#0f182f; color:#fff;
  }
  .help-text{ color:var(--muted); font-size:.9rem; }
  .text-danger{ font-weight:600; }

  
  .connector{ height:2px; background: linear-gradient(90deg, rgba(124,77,255,.6), rgba(36,225,255,.6)); opacity:.6; }

  
  .reveal{ opacity:0; transform: translateY(18px) scale(.98); transition: opacity .7s ease, transform .7s ease; }
  .reveal.in-view{ opacity:1; transform: none; }

  @media (max-width: 575.98px){ .page-title{ font-size:1.6rem; } }
</style>


<section class="position-relative py-4 tech-grid scanline">
  <div class="container position-relative">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div class="reveal">
        <span class="badge-chip mb-2">
          <svg class="me-1" width="18" height="18"><use href="#i-user"></use></svg>
          Daved AI · Profile
        </span>
        <h1 class="page-title fw-800 mb-0">Profile Settings</h1>
        <p class="text-secondary mb-0" style="color:var(--muted)">Update your account info, password, and preferences. Export your data anytime.</p>
      </div>
      <div class="d-flex gap-2 reveal">
        <a href="{{ url_for('main.projects') }}" class="btn btn-neon rounded-pill px-3">
          <svg class="me-2" width="18" height="18"><use href="#i-cloud"></use></svg> My Projects
        </a>
        <a href="{{ url_for('codegen.index') }}" class="btn btn-solid rounded-pill px-3">
          <svg class="me-2" width="18" height="18"><use href="#i-download"></use></svg> Generate
        </a>
      </div>
    </div>
  </div>
</section>


<section class="py-3 py-md-4">
  <div class="container">
    <div class="row g-4 justify-content-center">
      <div class="col-lg-10 col-xl-9">
        
        <div class="panel reveal tilt">
          <div class="panel-header">
            <h5 class="panel-title">
              <span class="ico"><svg width="22" height="22"><use href="#i-user"></use></svg></span>
              Account Details
            </h5>
          </div>
          <div class="p-3 p-md-4">
            
            <form method="POST" action="{{ url_for('main.profile') }}" novalidate>
              {{ form.hidden_tag() }}

              
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">
                    <svg width="16" height="16" class="me-1"><use href="#i-user"></use></svg>
                    {{ form.username.label.text }}
                  </label>
                  {{ form.username(class="form-control", placeholder="Your display name") }}
                  {% for error in form.username.errors %}
                    <div class="text-danger small mt-1">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6">
                  <label class="form-label">
                    <svg width="16" height="16" class="me-1"><use href="#i-mail"></use></svg>
                    {{ form.email.label.text }}
                  </label>
                  {{ form.email(class="form-control", placeholder="you@example.com") }}
                  {% for error in form.email.errors %}
                    <div class="text-danger small mt-1">{{ error }}</div>
                  {% endfor %}
                </div>
              </div>

              
              <div class="my-4 connector"></div>

              
              <div class="panel mb-4">
                <div class="panel-header">
                  <h6 class="panel-title">
                    <span class="ico" style="width:32px;height:32px;border-radius:8px;"><svg width="18" height="18"><use href="#i-lock"></use></svg></span>
                    Password Update
                  </h6>
                </div>
                <div class="p-3 p-md-4">
                  <div class="row g-3">
                    <div class="col-md-12">
                      <label class="form-label">{{ form.current_password.label.text }}</label>
                      {{ form.current_password(class="form-control", placeholder="Leave blank to keep current password") }}
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">{{ form.new_password.label.text }}</label>
                      {{ form.new_password(class="form-control", placeholder="New password") }}
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">{{ form.confirm_password.label.text }}</label>
                      {{ form.confirm_password(class="form-control", placeholder="Confirm new password") }}
                      {% for error in form.confirm_password.errors %}
                        <div class="text-danger small mt-1">{{ error }}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <p class="help-text mt-2 mb-0">Use 8+ characters with a mix of letters, numbers, and symbols.</p>
                </div>
              </div>

              
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">
                    <svg width="16" height="16" class="me-1"><use href="#i-gear"></use></svg>
                    {{ form.theme.label.text }}
                  </label>
                  {{ form.theme(class="form-select") }}
                </div>
                <div class="col-md-6">
                  <label class="form-label">
                    <svg width="16" height="16" class="me-1"><use href="#i-globe"></use></svg>
                    {{ form.language.label.text }}
                  </label>
                  {{ form.language(class="form-select") }}
                </div>
              </div>

              <div class="d-grid mt-4">
                {{ form.submit(class="btn btn-solid btn-lg rounded-pill") }}
              </div>
            </form>
          </div>
        </div>

        
        <div class="panel reveal tilt mt-5">
          <div class="panel-header">
            <h5 class="panel-title">
              <span class="ico"><svg width="22" height="22"><use href="#i-cloud"></use></svg></span>
              Export Your Data
            </h5>
          </div>
          <div class="p-3 p-md-4">
            <p class="mb-3 text-secondary" style="color:var(--muted)">Export your projects and uploaded files. We’ll package everything into a downloadable ZIP.</p>

            <div class="d-grid">
              <button id="export-data-btn" class="btn btn-neon rounded-pill">
                <svg class="me-2" width="18" height="18"><use href="#i-download"></use></svg>
                Export My Data
              </button>
            </div>

            
            <div id="export-progress" class="mt-4 d-none">
              <div class="progress sleek" style="height:8px; background:#0e162b; border-radius:999px;">
                <div class="progress-bar" id="export-progress-bar"
                     role="progressbar" style="width: 25%; background: linear-gradient(90deg, var(--grad-1), var(--grad-2));"
                     aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <p class="mt-2 text-center mb-0">Preparing your data export…</p>
            </div>

            
            <div id="export-success" class="mt-4 d-none">
              <div class="alert alert-success d-flex align-items-center gap-2 m-0" role="alert">
                <svg width="18" height="18"><use href="#i-check"></use></svg>
                <div>
                  Your data export is ready!
                  <a id="export-download-link" class="alert-link ms-1">Click here to download</a>
                </div>
              </div>
            </div>

            
            <div id="export-error" class="mt-4 d-none">
              <div class="alert alert-danger d-flex align-items-center gap-2 m-0" role="alert">
                <svg width="18" height="18"><use href="#i-x"></use></svg>
                <div>Export failed. Please try again.</div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  
  const revealEls = document.querySelectorAll('.reveal');
  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){ entry.target.classList.add('in-view'); io.unobserve(entry.target); }
    });
  }, { threshold: 0.15 });
  revealEls.forEach(el => io.observe(el));

  
  function tilt(el){
    let rect = null;
    function onMove(e){
      if(!rect) rect = el.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width - 0.5;
      const y = (e.clientY - rect.top) / rect.height - 0.5;
      el.style.transform = `perspective(800px) rotateX(${(-y*5).toFixed(2)}deg) rotateY(${(x*5).toFixed(2)}deg) translateY(-4px)`;
    }
    function reset(){ el.style.transform = ""; rect = null; }
    el.addEventListener('mousemove', onMove);
    el.addEventListener('mouseleave', reset);
  }
  document.querySelectorAll('.tilt').forEach(tilt);

  
  
  (function($){
    const hasjQ = typeof $ === 'function';
    if(!hasjQ) return;

    $(document).ready(function() {
      const csrfToken = $('meta[name="csrf-token"]').attr('content');

      $('#export-data-btn').on('click', function() {
        $('#export-error').addClass('d-none');
        $('#export-success').addClass('d-none');
        $('#export-data-btn').prop('disabled', true);
        $('#export-progress').removeClass('d-none');

        
        let pct = 25; const bar = $('#export-progress-bar');
        const t = setInterval(function(){
          pct = Math.min(95, pct + Math.random()*8);
          bar.css('width', pct + '%').attr('aria-valuenow', Math.round(pct));
        }, 500);

        $.ajax({
          url: "{{ url_for('main.export_data') }}",
          method: 'POST',
          contentType: 'application/json',
          headers: { 'X-CSRFToken': csrfToken },
          success: function(response) {
            clearInterval(t);
            if (response && response.success) {
              bar.css('width', '100%').attr('aria-valuenow', 100);
              $('#export-progress').addClass('d-none');
              $('#export-success').removeClass('d-none');
              $('#export-download-link').attr('href', response.download_url);
            } else {
              $('#export-progress').addClass('d-none');
              $('#export-error').removeClass('d-none');
              $('#export-data-btn').prop('disabled', false);
            }
          },
          error: function() {
            clearInterval(t);
            $('#export-progress').addClass('d-none');
            $('#export-error').removeClass('d-none');
            $('#export-data-btn').prop('disabled', false);
          }
        });
      });
    });
  })(window.jQuery);
</script>
{% endblock %}
