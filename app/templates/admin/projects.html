
{% extends "base.html" %}

{% block title %}Project Management · Daved AI{% endblock %}

{% block content %}

<svg aria-hidden="true" class="d-none">
  <defs>
    <filter id="glow" x="-40%" y="-40%" width="180%" height="180%"><feGaussianBlur stdDeviation="3.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    <symbol id="i-folder" viewBox="0 0 24 24"><path d="M3 7h6l2 2h10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="i-search" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"/><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
    <symbol id="i-clock" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l4 2" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
    <symbol id="i-trash" viewBox="0 0 24 24"><path d="M3 6h18M8 6V4h8v2M7 6l1 14h8l1-14" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
  </defs>
</svg>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  :root{ --bg:#0b0f1a; --bg-soft:#0f1526; --card:#121a2d; --text:#d7e3ff; --muted:#9bb0d8; --grad-1:#6a00ff; --grad-2:#00e1ff; --grad-3:#8a2be2; }
  body{ background: radial-gradient(1200px 600px at 10% -10%, #1a2341 0%, transparent 60%), var(--bg); color:var(--text); font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  .badge-chip{ display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .65rem; border-radius:999px; background:rgba(124,77,255,.12); border:1px solid rgba(124,77,255,.25); color:var(--muted); font-weight:600; font-size:.9rem;}
  .panel{ background: linear-gradient(180deg, rgba(255,255,255,.02),rgba(255,255,255,0)), #121a2d; border:1px solid rgba(255,255,255,.06); border-radius:16px; position:relative; overflow:hidden; transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s, border-color .35s;}
  .panel:hover{ transform:translateY(-4px); box-shadow:0 16px 60px rgba(0,0,0,.35),0 0 60px rgba(124,77,255,.15); border-color:rgba(124,77,255,.35);}
  .panel-header{ border-bottom:1px solid rgba(255,255,255,.06); background:#0b1224; padding:.9rem 1rem; }
  .panel-title{ margin:0; display:flex; align-items:center; gap:.6rem; font-weight:700; }
  .ico{ width:40px; height:40px; display:grid; place-items:center; border-radius:12px; color:#fff; background:radial-gradient(circle at 30% 30%, rgba(36,225,255,.25), rgba(124,77,255,.45)); filter:url(#glow); }
  .filter-input{ background:#0e162b; border:1px solid rgba(255,255,255,.08); color:var(--text); border-radius:12px; }
  .filter-input:focus{ border-color: rgba(36,225,255,.6); box-shadow: 0 0 0 .25rem rgba(36,225,255,.15); background:#0f182f; }
  .table-dark-glass{ --bs-table-bg: transparent; --bs-table-color:var(--text); }
  .table-dark-glass td,.table-dark-glass th{ border-color: rgba(255,255,255,.06); vertical-align:middle; }
  .table-dark-glass tbody tr:hover{ background: rgba(124,77,255,.08); transform: translateY(-1px); }
  .badge-soft{ border:1px solid rgba(255,255,255,.12); padding:.35rem .6rem; border-radius:999px; font-weight:600; }
  .badge-completed{ background: rgba(46,204,113,.15); color:#aef0c8; border-color: rgba(46,204,113,.35); }
  .badge-running{ background: rgba(255,193,7,.15); color:#ffe3a3; border-color: rgba(255,193,7,.35); }
  .badge-other{ background: rgba(255,255,255,.08); color:#d7e3ff; }
  .reveal{ opacity:0; transform: translateY(18px) scale(.98); transition: opacity .7s ease, transform .7s ease; }
  .reveal.in-view{ opacity:1; transform:none; }
  .tilt{ will-change: transform; }
  .page-sub{ color:var(--muted); }
</style>

<section class="position-relative py-4">
  <div class="container">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div class="reveal">
        <span class="badge-chip mb-2"><svg class="me-1" width="18" height="18"><use href="#i-folder"></use></svg> Daved AI · Admin</span>
        <h1 class="page-title fw-800 mb-0">Project Management</h1>
        <p class="page-sub mb-0">{{ projects.total }} projects</p>
      </div>
    </div>
  </div>
</section>

<section class="py-3 py-md-4">
  <div class="container">
    <div class="panel reveal tilt">
      <div class="panel-header">
        <h5 class="panel-title"><span class="ico"><svg width="22" height="22"><use href="#i-folder"></use></svg></span> All Projects</h5>
      </div>
      <div class="p-3 p-md-4">
        <div class="row g-3 align-items-center mb-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text bg-transparent border-0"><svg width="18" height="18"><use href="#i-search"></use></svg></span>
              <input type="search" id="project-search" class="form-control filter-input" placeholder="Search by title or owner…">
            </div>
          </div>
          <div class="col-md-3">
            <select id="status-filter" class="form-select filter-input">
              <option value="">All statuses</option>
              <option value="completed">Completed</option>
              <option value="in-progress">In Progress</option>
            </select>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-dark-glass align-middle" id="projects-table">
            <thead>
              <tr>
                <th style="color:#9bb0d8" class="text-uppercase small">ID</th>
                <th style="color:#9bb0d8" class="text-uppercase small">Title</th>
                <th style="color:#9bb0d8" class="text-uppercase small">Owner</th>
                <th style="color:#9bb0d8" class="text-uppercase small">Created</th>
                <th style="color:#9bb0d8" class="text-uppercase small">Status</th>
                <th style="color:#9bb0d8" class="text-uppercase small">Files</th>
                <th class="text-end" style="color:#9bb0d8" class="text-uppercase small">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for project in projects.items %}
              <tr data-title="{{ project.title|lower }}" data-owner="{{ project.owner.username|lower }}" data-status="{{ project.status|lower }}">
                <td>{{ project.id }}</td>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <span class="ico" style="width:32px;height:32px;border-radius:8px;"><svg width="18" height="18"><use href="#i-folder"></use></svg></span>
                    <strong>{{ project.title }}</strong>
                  </div>
                </td>
                <td>{{ project.owner.username }}</td>
                <td>{{ project.created_at.strftime('%Y-%m-%d') }}</td>
                <td>
                  {% if project.status == 'completed' %}
                    <span class="badge-soft badge-completed">Completed</span>
                  {% elif project.status == 'in-progress' %}
                    <span class="badge-soft badge-running">In&nbsp;Progress</span>
                  {% else %}
                    <span class="badge-soft badge-other">{{ project.status }}</span>
                  {% endif %}
                </td>
                <td>{{ project.files|length }}</td>
                <td class="text-end">
                  <form method="POST" action="{{ url_for('admin.delete_project', project_id=project.id) }}" class="d-inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-sm btn-neon rounded-pill">
                      <svg class="me-1" width="16" height="16"><use href="#i-trash"></use></svg> Delete
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <nav class="mt-3">
          <ul class="pagination justify-content-center">
            {% if projects.has_prev %}
            <li class="page-item"><a class="page-link" href="{{ url_for('admin.project_management', page=projects.prev_num) }}">&laquo;</a></li>
            {% endif %}
            {% for page_num in projects.iter_pages() %}
              {% if page_num %}
                <li class="page-item {% if page_num == projects.page %}active{% endif %}">
                  <a class="page-link" href="{{ url_for('admin.project_management', page=page_num) }}">{{ page_num }}</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">…</span></li>
              {% endif %}
            {% endfor %}
            {% if projects.has_next %}
            <li class="page-item"><a class="page-link" href="{{ url_for('admin.project_management', page=projects.next_num) }}">&raquo;</a></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
  </div>
</section>

<script>
  const rEls=document.querySelectorAll('.reveal'); const io=new IntersectionObserver((es)=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('in-view'); io.unobserve(e.target);}}),{threshold:.15}); rEls.forEach(el=>io.observe(el));
  function tilt(el){ let rect=null; el.addEventListener('mousemove',e=>{ if(!rect) rect=el.getBoundingClientRect(); const x=(e.clientX-rect.left)/rect.width-.5; const y=(e.clientY-rect.top)/rect.height-.5; el.style.transform=`perspective(800px) rotateX(${(-y*5).toFixed(2)}deg) rotateY(${(x*5).toFixed(2)}deg) translateY(-4px)`;}); el.addEventListener('mouseleave',()=>{ el.style.transform=""; rect=null;});}
  document.querySelectorAll('.tilt').forEach(tilt);

  (function(){
    const rows=Array.from((document.querySelector('#projects-table tbody')||{}).rows||[]);
    const q=document.getElementById('project-search'); const sf=document.getElementById('status-filter');
    function apply(){
      const text=(q?.value||'').trim().toLowerCase(); const st=(sf?.value||'').toLowerCase();
      rows.forEach(tr=>{
        const title=tr.getAttribute('data-title')||''; const owner=tr.getAttribute('data-owner')||''; const rowSt=tr.getAttribute('data-status')||'';
        const matchText=!text || title.includes(text) || owner.includes(text); const matchSt=!st || rowSt===st;
        tr.style.display=(matchText && matchSt)?'':'none';
      });
    }
    q&&q.addEventListener('input',apply); sf&&sf.addEventListener('change',apply);
  })();
</script>
{% endblock %}
