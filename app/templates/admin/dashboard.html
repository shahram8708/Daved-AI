
{% extends "base.html" %}

{% block title %}Admin Dashboard · Daved AI{% endblock %}

{% block styles %}

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

  :root{
    --bg:#0b0f1a;
    --bg-soft:#0f1526;
    --card:#121a2d;
    --line:#1b2540;
    --text:#d7e3ff;
    --muted:#9bb0d8;
    --primary:#7c4dff;
    --cyan:#24e1ff;
    --grad-1:#6a00ff;
    --grad-2:#00e1ff;
    --grad-3:#8a2be2;
    --green:#2ecc71;
    --amber:#ffc107;
    --red:#ff6b6b;
    --blue:#24a2ff;
  }

  body{
    background: radial-gradient(1200px 600px at 10% -10%, #1a2341 0%, transparent 60%), var(--bg);
    color: var(--text);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  
  .tech-grid::before{
    content:""; position:absolute; inset:0; background:
      linear-gradient(transparent 95%, rgba(255,255,255,.04) 95%) 0 0/100% 2px,
      linear-gradient(90deg, transparent 95%, rgba(255,255,255,.04) 95%) 0 0/2px 100%;
    pointer-events:none; mix-blend:overlay;
  }
  .scanline::after{
    content:""; position:absolute; inset:0;
    background: linear-gradient(rgba(255,255,255,.05), rgba(255,255,255,0) 80%);
    opacity:.2; animation: scan 6s linear infinite; pointer-events:none;
  }
  @keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}

  
  .neon{ background: linear-gradient(135deg, var(--grad-1), var(--grad-2), var(--grad-3)); background-size:200% 200%; animation: gradientMove 10s ease infinite; }
  @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

  
  .badge-chip{ display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .65rem; border-radius:999px; background: rgba(124,77,255,.12); border:1px solid rgba(124,77,255,.25); color:var(--muted); font-weight:600; font-size:.9rem; }
  .btn-neon{
    --bs-btn-bg: transparent; --bs-btn-border-color: rgba(124,77,255,.5); --bs-btn-color:#fff;
    border:1px solid var(--bs-btn-border-color); backdrop-filter: blur(6px);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 0 20px rgba(124,77,255,.25);
    transition: transform .25s, box-shadow .25s, border-color .25s;
  }
  .btn-neon:hover{ transform: translateY(-2px); border-color: var(--cyan); box-shadow: 0 8px 30px rgba(36,225,255,.25); }
  .btn-solid{ background: linear-gradient(135deg, var(--grad-1), var(--grad-2)); border:0; color:#fff; box-shadow: 0 6px 30px rgba(124,77,255,.35); }
  .btn-solid:hover{ filter: brightness(1.08); transform: translateY(-2px); }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--card);
    border: 1px solid rgba(255,255,255,.06); border-radius: 16px;
    transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s, border-color .35s; position:relative; overflow:hidden;
  }
  .panel:hover{ transform: translateY(-4px); box-shadow: 0 16px 60px rgba(0,0,0,.35), 0 0 60px rgba(124,77,255,.15); border-color: rgba(124,77,255,.35); }
  .panel-header{ border-bottom:1px solid rgba(255,255,255,.06); background:#0b1224; padding:.9rem 1rem; }
  .panel-title{ margin:0; display:flex; align-items:center; gap:.6rem; font-weight:700; }
  .ico{
    width:40px; height:40px; display:grid; place-items:center; border-radius:12px; color:#fff;
    background: radial-gradient(circle at 30% 30%, rgba(36,225,255,.25), rgba(124,77,255,.45));
    box-shadow: 0 10px 30px rgba(124,77,255,.35) inset; filter:url(#glow);
  }
  .tilt{ will-change: transform; }

  
  .kpi{
    padding:1.1rem 1.25rem; border-radius:16px;
    background: linear-gradient(180deg, rgba(124,77,255,.08), rgba(36,225,255,.04)), var(--bg-soft);
    border:1px solid rgba(255,255,255,.06);
  }
  .kpi h6{ color:var(--muted); margin-bottom:.2rem; }
  .kpi strong{ font-size:1.8rem; line-height:1; display:block; }
  .kpi small{ color:var(--muted); }

  
  .list-dark .list-group-item{
    background: transparent; color: var(--text);
    border: 1px solid rgba(255,255,255,.06); border-left:0; border-right:0;
  }
  .list-dark .list-group-item:hover{ background: rgba(124,77,255,.08); }

  
  .reveal{ opacity:0; transform: translateY(18px) scale(.98); transition: opacity .7s ease, transform .7s ease; }
  .reveal.in-view{ opacity:1; transform: none; }

  
  .page-sub{ color:var(--muted); }

  @media (max-width: 575.98px){ .page-title{ font-size:1.6rem; } }
</style>
{% endblock %}

{% block content %}

<svg aria-hidden="true" class="d-none">
  <defs>
    <filter id="glow" x="-40%" y="-40%" width="180%" height="180%">
      <feGaussianBlur stdDeviation="3.5" result="coloredBlur" />
      <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>

    <symbol id="i-dashboard" viewBox="0 0 24 24">
      <path d="M3 13h8V3H3zM13 21h8V3h-8zm-10 8" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M3 21h8v-6H3z" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-users" viewBox="0 0 24 24">
      <path d="M16 11a4 4 0 1 0-8 0" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M2 21a7 7 0 0 1 10-6.3M22 21a7 7 0 0 0-10-6.3" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
    <symbol id="i-user-check" viewBox="0 0 24 24">
      <path d="M16 11a4 4 0 1 0-8 0" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M2 21a7 7 0 0 1 10-6.3" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M16 19l2 2 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
    <symbol id="i-folder" viewBox="0 0 24 24">
      <path d="M3 7h6l2 2h10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
    <symbol id="i-graph" viewBox="0 0 24 24">
      <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M7 15l3-3 3 2 4-5" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
    <symbol id="i-clock" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M12 7v5l4 2" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
    <symbol id="i-activity" viewBox="0 0 24 24">
      <path d="M3 12h4l2-6 4 12 2-6h6" stroke="currentColor" stroke-width="2" fill="none"/>
    </symbol>
  </defs>
</svg>


<section class="position-relative py-4 tech-grid scanline">
  <div class="container position-relative">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div class="reveal">
        <span class="badge-chip mb-2">
          <svg class="me-1" width="18" height="18"><use href="#i-dashboard"></use></svg>
          Daved AI · Admin
        </span>
        <h1 class="page-title fw-800 mb-0">Admin Dashboard</h1>
        <p class="page-sub mb-0">Operational overview, usage, and recent admin activity.</p>
      </div>
      <div class="reveal text-end">
        <div class="small page-sub">
          <svg width="16" height="16" class="me-1"><use href="#i-clock"></use></svg>
          Last updated: {{ now.strftime('%Y-%m-%d %H:%M') }}
        </div>
      </div>
    </div>
  </div>
</section>


<section class="py-3 py-md-4">
  <div class="container">
    
    <div class="row g-3 mb-3">
      <div class="col-6 col-md-4">
        <div class="kpi reveal tilt">
          <h6>Total Users</h6>
          <strong data-count="{{ total_users }}">{{ total_users }}</strong>
          <small class="d-inline-flex align-items-center gap-1">
            <svg width="16" height="16"><use href="#i-users"></use></svg> system-wide
          </small>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="kpi reveal tilt">
          <h6>Active Users</h6>
          <strong data-count="{{ active_users }}">{{ active_users }}</strong>
          <small class="d-inline-flex align-items-center gap-1">
            <svg width="16" height="16"><use href="#i-user-check"></use></svg> last 24h
          </small>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="kpi reveal tilt">
          <h6>Total Projects</h6>
          <strong data-count="{{ total_projects }}">{{ total_projects }}</strong>
          <small class="d-inline-flex align-items-center gap-1">
            <svg width="16" height="16"><use href="#i-folder"></use></svg> generated
          </small>
        </div>
      </div>
    </div>

    
    <div class="row g-4 mb-4">
      
      <div class="col-lg-6">
        <div class="panel reveal tilt h-100">
          <div class="panel-header">
            <h5 class="panel-title">
              <span class="ico"><svg width="22" height="22"><use href="#i-graph"></use></svg></span>
              AI Usage by Mode
            </h5>
          </div>
          <div class="p-3 p-md-4">
            <div style="height:320px">
              <canvas id="usageChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      
      <div class="col-lg-6">
        <div class="panel reveal tilt h-100">
          <div class="panel-header">
            <h5 class="panel-title">
              <span class="ico"><svg width="22" height="22"><use href="#i-activity"></use></svg></span>
              Recent Activities
            </h5>
          </div>
          <div class="p-3 p-md-4">
            <div class="list-group list-dark">
              {% for activity in recent_activities %}
                <div class="list-group-item py-3">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">{{ activity.admin.username }} — {{ activity.action }}</h6>
                    <small class="page-sub">{{ activity.timestamp|time_ago }}</small>
                  </div>
                  {% if activity.target_type and activity.target_id %}
                    <small class="page-sub">Target: {{ activity.target_type }} #{{ activity.target_id }}</small>
                  {% endif %}
                </div>
              {% else %}
                <div class="text-center py-4">
                  <div class="ico mx-auto mb-3" style="width:56px;height:56px;"><svg width="26" height="26"><use href="#i-activity"></use></svg></div>
                  <p class="mb-0 page-sub">No recent activities</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    
    <div class="p-4 p-md-5 rounded-4 position-relative overflow-hidden panel reveal tilt">
      <div class="position-absolute top-0 start-0 w-100 h-100 neon" style="opacity:.07;"></div>
      <div class="position-relative d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
        <div>
          <h4 class="mb-1">Need deeper insights?</h4>
          <p class="mb-0 page-sub">Open the full analytics view to explore per-workspace, per-model, and latency dashboards.</p>
        </div>
        <a class="btn btn-solid rounded-pill px-4" href="#">
          Open Analytics
        </a>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  
  const revealEls = document.querySelectorAll('.reveal');
  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){ entry.target.classList.add('in-view'); io.unobserve(entry.target); }
    });
  }, { threshold: 0.15 });
  revealEls.forEach(el => io.observe(el));

  
  function tilt(el){
    let rect = null;
    function onMove(e){
      if(!rect) rect = el.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width - 0.5;
      const y = (e.clientY - rect.top) / rect.height - 0.5;
      el.style.transform = `perspective(800px) rotateX(${(-y*5).toFixed(2)}deg) rotateY(${(x*5).toFixed(2)}deg) translateY(-4px)`;
    }
    function reset(){ el.style.transform = ""; rect = null; }
    el.addEventListener('mousemove', onMove);
    el.addEventListener('mouseleave', reset);
  }
  document.querySelectorAll('.tilt').forEach(tilt);

  
  document.querySelectorAll('.kpi strong[data-count]').forEach(el => {
    const target = Number(el.getAttribute('data-count')) || 0;
    const duration = 700; const start = performance.now();
    function tick(now){
      const p = Math.min(1, (now - start) / duration);
      const val = Math.floor(target * (0.2 + 0.8 * p));
      el.textContent = val.toLocaleString();
      if(p < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  });

  
  document.addEventListener('DOMContentLoaded', function() {
    const usageData = JSON.parse('{{ usage_data|safe }}'); 
    const labels = Object.keys(usageData);
    const data = Object.values(usageData);

    const ctx = document.getElementById('usageChart');
    if(!ctx) return;

    
    const bg = [
      'rgba(122, 77, 255, .75)',  
      'rgba(36, 225, 255, .75)',  
      'rgba(138, 43, 226, .75)',  
      'rgba(46, 204, 113, .75)',  
      'rgba(255, 193, 7, .75)',   
      'rgba(36, 162, 255, .75)'   
    ];
    const br = [
      'rgba(122, 77, 255, 1)',
      'rgba(36, 225, 255, 1)',
      'rgba(138, 43, 226, 1)',
      'rgba(46, 204, 113, 1)',
      'rgba(255, 193, 7, 1)',
      'rgba(36, 162, 255, 1)'
    ];

    
    Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#d7e3ff';
    Chart.defaults.font.family = 'Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

    new Chart(ctx.getContext('2d'), {
      type: 'doughnut',
      data: {
        labels,
        datasets: [{
          data,
          backgroundColor: labels.map((_, i) => bg[i % bg.length]),
          borderColor: labels.map((_, i) => br[i % br.length]),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '60%',
        plugins: {
          legend: {
            position: 'bottom',
            labels: { boxWidth: 12, padding: 16 }
          },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.label}: ${ctx.raw.toLocaleString()} requests`
            }
          }
        }
      }
    });
  });
</script>
{% endblock %}
